---
title: Docker Compose
description: Service topology, compose variants, and operational commands.
order: 10
---

<DocMeta source=".docs/guides/DOCKER-BUILD-STRATEGIES.md" scope="supplemental" />

This page explains how to work with the provided Docker Compose files for both development and production, without repeating the build strategy or deployment specifics. For deeper context, see:

- [Docker Build Strategies](/docs/docker/docker-build-strategies)
- [Production Deployment](/docs/deployment/production-deployment)
- [Project Isolation](/docs/tooling/project-isolation)

## Quick start (development)

Use the root scripts which wrap Compose and manage env for you.

```bash
# Full stack (API + Web + DB + Redis)
 bun run dev

# API only
 bun run dev:api

# Web only
 bun run dev:web

# View logs (follow)
 bun run dev:api:logs
 bun run dev:web:logs

# Stop stacks
 bun run dev:api:down
 bun run dev:web:down
```

Notes:
- Hot reloading is enabled for both apps in dev.
- Services share an internal Docker network.
- Route generation and ORPC generation are handled by the app scripts.

## Partial development

You can run API and Web separately. The Web dev file connects to an external API URL. Ensure the API is running and that your `.env` points the web service to it.

## Production with Compose

You can run production-like stacks locally using the `prod` scripts, or deploy to a platform (see Render docs). API and web can be run independently.

```bash
# API (prod)
 bun run prod:api         # compose up
 bun run prod:api:build   # rebuild and up
 bun run prod:api:down    # down (add :volumes to remove volumes)

# Web (prod)
 bun run prod:web         # compose up
 bun run prod:web:build   # rebuild and up
 bun run prod:web:down    # down (add :volumes to remove volumes)

# Combined (both)
 bun run start            # uses docker-compose.prod.yml
```

Environment files are generated from templates via `bun run init`; keep them synchronized with deployment targets.

## Environment variables

Common keys used by Compose services (examples):
- `NEXT_PUBLIC_API_URL` – base URL of the API for the web app
- `NEXT_PUBLIC_APP_URL` – URL of the web app (for links/callbacks)
- `API_PORT` / `NEXT_PUBLIC_APP_PORT` – exposed host ports
- `DATABASE_URL` – Postgres connection string (API)

See the Environment Template System → /docs/environment-template-system for a guided way to generate `.env`.

See [Environment Template System](/docs/tooling/environment-template-system) for guided env generation and validation.

## Project isolation (multiple instances)

To avoid name collisions when running multiple copies on the same machine, set a project prefix in `.env`:

```bash
COMPOSE_PROJECT_NAME=my-project
```

All container, network, and volume names will be prefixed. See Project Isolation → /docs/project-isolation.
All container, network, and volume names will be prefixed. See [Project Isolation](/docs/tooling/project-isolation).

## Useful commands

```bash
# Show all running containers for this project
 docker ps --filter "name=${COMPOSE_PROJECT_NAME:-nextjs-directus}"

# Tail logs directly via compose files
 docker compose -f ./docker-compose.api.yml logs -f
 docker compose -f ./docker-compose.web.yml logs -f

# Rebuild images
 docker compose -f ./docker-compose.api.yml up --build
 docker compose -f ./docker-compose.web.yml up --build

# Exec into a container shell (root scripts provided)
 bun run dev:api:run
```

## Troubleshooting

- Ports in use: stop other services using 3000/3001 or edit the env ports.
- Env mismatch: ensure `.env` is present and values are correct (URLs, secrets, DB).
- Recreate fresh dev data: use `:down:volumes` scripts to drop volumes and re-create.
- API not reachable from Web: confirm Docker network reachability and correct `NEXT_PUBLIC_API_URL` (use container hostname for server-to-server, localhost for browser).

## When to use which Compose file

- Build-time vs Runtime build options are explained in Docker Build Strategies.
- For local dev: prefer `docker-compose.yml` (and the API/Web splits for focused work).
- For self-hosted prod: choose `docker-compose.prod.yml` or the split API/Web prod files to deploy separately.

## Related docs

- [Docker Build Strategies](/docs/docker/docker-build-strategies)
- [Production Deployment](/docs/deployment/production-deployment)
- [Render Deployment](/docs/deployment/render-deployment)
- [Project Isolation](/docs/tooling/project-isolation)

## Compose hygiene checklist

<DocChecklist
	items={[
		{ label: 'Ports and URLs aligned with .env', done: false },
		{ label: 'Service names stable across compose variants', done: false },
		{ label: 'Volume strategy understood before reset', done: false },
		{ label: 'Logs checked before restarting all services', done: false },
	]}
/>
